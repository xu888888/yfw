"use strict";function getStorage(){return JSON.parse(localStorage.getItem("list")||"[]")}function setStorage(e){localStorage.setItem("list",JSON.stringify(e))}function renderCar(e,t){if(e.length<1)$("#box").html('<a href="./index.html" style="display: block;height: 200px;line-height:200px;text-align:center;font-size: 30px;color: #0cb95f">商品为空，再去逛逛</a>'),$(".car_num").text("0");else{for(var n="",i=0;i<e.length;i++)n+='\n            <div class="item_qin">\n                <div class="item_tou">\n                    <a href="#">'.concat(e[i].shop,'</a>\n                </div>\n                <div class="item_main">\n                    <input type="checkbox" class="lie">\n                    <a href="#" class="tutu"><img src="').concat(e[i].img,'" alt=""></a>\n                    <div class="bewrite">\n                        <a href="#">').concat(e[i].name,"</a>\n                        <p>规格：").concat(e[i].spec,"</p>\n                        <p>厂家：").concat(e[i].vender,'</p>\n                        <p class="shop_id">').concat(e[i].id,'</p>\n                    </div>\n                    <p class="price">￥').concat(e[i].price,'</p>\n                    <div class="number">\n                        <a href="javascript:;" class="jian"><i class="iconfont">&#xe6ca;</i></a>\n                        <input type="text" value=').concat(e[i].num,' class="shop_num">\n                        <a href="javascript:;" class="jia"><i class="iconfont">&#xe6c9;</i></a>\n                    </div>\n                    <p class="total">￥').concat((e[i].price*e[i].num).toFixed(2),'</p>\n                    <a href="javascript:;" class="del">删除</a>\n                </div>\n                <div class="item_money">\n                    <p>\n                        商品金额合计：￥<span class="heji">0.00</span>\n                    </p>\n                </div>\n            </div>');$(".car_num").text(e.length)}$("#box").html(n),$(".all_item").change(function(){$(".lie, .all_item").prop("checked",$(this).prop("checked")),$(this).prop("checked")?($(".item_main").addClass("check-cart-item"),getSum()):($(".item_main").removeClass("check-cart-item"),getSum(),$(".heji").text("0.00"))}),$(".lie").change(function(){$(".lie:checked").length==$(".lie").length?$(".all_item").prop("checked",!0):$(".all_item").prop("checked",!1),$(this).prop("checked")?($(this).parent().addClass("check-cart-item"),getSum()):($(this).parent().removeClass("check-cart-item"),getSum(),$(this).parent().siblings(".item_money").children().children().text("0.00"))}),addDeleteEvent(),addNumChangeEvent()}function getSum(){var i=0;$(".lie:checked").each(function(e,t){var n=$(t).siblings(".total").text();n=parseInt(n.slice(1)),$(t).parent().siblings(".item_money").children().children().text(n.toFixed(2)),i+=parseInt($(t).parent().siblings(".item_money").children().children().text())}),$(".totals").text("￥"+i.toFixed(2))}function addDeleteEvent(){$(".del").click(function(){var e=$(this).siblings(".bewrite").children().eq(3).html();$.ajax({url:"../php/delwq.php",data:{id:e,type:"del"},dataType:"json",success:function(e){}}),removeProduct(e)})}function removeProduct(e){for(var t=getStorage(),n=0;n<t.length;n++)t[n].id==e&&(t.splice(n,1),setStorage(t),renderCar(getStorage(),"#box"))}function addNumChangeEvent(){$(".jia").click(function(){$(this).siblings(".shop_num").val(Number($(this).siblings(".shop_num").val())+1);for(var e=getStorage(),t=$(this).parent().siblings(".bewrite").children().eq(3).html(),n=0;n<e.length;n++)e[n].id==t&&(e[n].num=e[n].num+1,setStorage(e),$(this).parent().siblings(".total").html("￥"+(e[n].num*e[n].price).toFixed(2)));$(this).parent().siblings(".lie").prop("checked")&&getSum(),$.ajax({url:"../php/updatewq.php",dataType:"json",data:{id:t,type:"add"}})}),$(".jian").click(function(){$(this).siblings(".shop_num").val(Number($(this).siblings(".shop_num").val())-1);for(var e=getStorage(),t=$(this).parent().siblings(".bewrite").children().eq(3).html(),n=0;n<e.length;n++)e[n].id==t&&(1<=$(this).siblings(".shop_num").val()?(e[n].num=e[n].num-1,setStorage(e),$(this).parent().siblings(".total").html("￥"+(e[n].num*e[n].price).toFixed(2))):$(this).siblings(".shop_num").val(1));$(this).parent().siblings(".lie").prop("checked")&&getSum(),$.ajax({url:"../php/updatewq.php",dataType:"json",data:{id:t,type:"jian"}})}),$(".shop_num").on("keyup",function(e){if(e.target.value=e.target.value.replace(/\D/g,""),13==e.keyCode){$(this).blur();for(var t=getStorage(),n=$(this).parent().siblings(".bewrite").children().eq(3).html(),i=0;i<t.length;i++)t[i].id==n&&(t[i].num=parseInt($(this).val()),setStorage(t),$(this).parent().siblings(".total").html("￥"+(t[i].num*t[i].price).toFixed(2)));$.ajax({url:"../php/updatewq.php",dataType:"json",data:{id:n,type:"gai",num:$(this).val()}})}$(this).parent().siblings(".lie").prop("checked")&&getSum()})}null!=localStorage.getItem("names")?($(".login-button").html(localStorage.getItem("names")),$(".reset-button").html("[退出]"),$(".login").html("您好"+$(".login").html()),$(".reset-button").click(function(){localStorage.removeItem("names"),location.href="./login.html"})):($(".login-button").html("登录"),$(".reset-button").html("注册"),$(".login").html(" "+$(".login").html()),$(".reset-button").click(function(){location.href="./enroll.html",$(this).target="_blank"}),$(".login-button").click(function(){location.href="./login.html",$(this).target="_blank"})),$(".clearAll").click(function(){$(".all_item").prop("checked")&&(localStorage.removeItem("list"),renderCar(getStorage(),"#box"),$(".all_item").prop("checked",!1),$.ajax({url:"../php/delwq.php",data:{type:"clear"},dataType:"json",success:function(e){}}))}),renderCar(getStorage(),"#box");